<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Nginx 开启支持 HTTP2 | ICE.GS</title><meta name="description" content="A geeker blog."><meta name="keywords" content="hexo,theme,icer,ggice"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="HTTP2的好处Server Push 主动推送资源 （目前nginx还不支持，新版本nodeJs可以配置实现）用帧二进制编码传输数据，连接可以承载任意数量的双向数据流 (所以不用关心，请求的数量了)头部压缩，减少请求时间版本要求Nginx 1.9.5 及其以上版本配置其实配置很简单，只需要在原本配置的listen处加入 http2 的声明即可，而且对无法支持HTTP2的浏览器，nginx会做自动"><meta name="keywords" content="web development,nginx"><meta property="og:type" content="article"><meta property="og:title" content="Nginx 开启支持 HTTP2"><meta property="og:url" content="https://ice.gs/2017/06/17/nginx-qi-yong-http2-2/index.html"><meta property="og:site_name" content="ICE.GS"><meta property="og:description" content="HTTP2的好处Server Push 主动推送资源 （目前nginx还不支持，新版本nodeJs可以配置实现）用帧二进制编码传输数据，连接可以承载任意数量的双向数据流 (所以不用关心，请求的数量了)头部压缩，减少请求时间版本要求Nginx 1.9.5 及其以上版本配置其实配置很简单，只需要在原本配置的listen处加入 http2 的声明即可，而且对无法支持HTTP2的浏览器，nginx会做自动"><meta property="og:image" content="https://ice.gs/images/2017/06/http2-1.png"><meta property="og:image" content="https://ice.gs/images/2017/06/http2-2.png"><meta property="og:updated_time" content="2017-06-17T06:54:03.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Nginx 开启支持 HTTP2"><meta name="twitter:description" content="HTTP2的好处Server Push 主动推送资源 （目前nginx还不支持，新版本nodeJs可以配置实现）用帧二进制编码传输数据，连接可以承载任意数量的双向数据流 (所以不用关心，请求的数量了)头部压缩，减少请求时间版本要求Nginx 1.9.5 及其以上版本配置其实配置很简单，只需要在原本配置的listen处加入 http2 的声明即可，而且对无法支持HTTP2的浏览器，nginx会做自动"><meta name="twitter:image" content="https://ice.gs/images/2017/06/http2-1.png"><link rel="stylesheet" href="//cdnjs.xyz/libs/nprogress/0.2.0/nprogress.css"><link rel="stylesheet" href="//cdnjs.xyz/libs/highlight/9.12.0/styles/github-gist.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_405585_2mmfrz9pgd7h9f6r.css"><script src="//cdnjs.xyz/libs/nprogress/0.2.0/nprogress.js"></script><link rel="stylesheet" href="/style.css"><script type="text/javascript">!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-93986029-1","auto"),ga("send","pageview")</script></head></html><body><script>NProgress.start()</script><div id="site-wrapper"><header class="header"><div class="header-wrapper"><a href="/"><img src="/image/logo.jpg" class="logo"></a><div class="social-wrapper"><a href="https://twitter.com/iggice" class="social twitter" target="_blank" rel="external"><span class="iconfont icon-twitter"></span> </a><a href="https://github.com/ggice" class="social github" target="_blank" rel="external"><span class="iconfont icon-github"></span> </a><a href="http://ggice.tumblr.com/" class="social tumblr" target="_blank" rel="external"><span class="iconfont icon-tumblr"></span> </a><a href="https://dribbble.com/ggice" class="social dribbble" target="_blank" rel="external"><span class="iconfont icon-dribbble"></span> </a><a href="mailto:i@ice.gs" class="social email" target="_blank" rel="external"><span class="iconfont icon-email"></span> </a><a href="/atom.xml" class="social rss" target="_blank" rel="external"><span class="iconfont icon-rss"></span> </a><a href="#" class="social search-do" target="_blank" rel="external"><span class="iconfont icon-search"></span></a></div><div class="search-wrap"><div class="search-content animated fade-in"><p class="search-input"><span class="iconfont icon-search"></span> <input tabindex="1"></p><ul class="search-result"><div class="tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac-os-X/">Mac os X</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/os/">os</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/others/">others</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberry-pi/">raspberry pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/soft/">soft</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-development/">web development</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-development推荐方法/">web development推荐方法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/work/">work</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/模块加载器/">模块加载器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编辑器/">编辑器</a></li></ul></div></ul></div></div><nav class="header-nav"><a href="/" class="archives">home </a><a href="/tags/web-development/" class="archives">web development </a><a href="/tags/soft/" class="archives">soft </a><a href="/tags/os/" class="archives">os </a><a href="/archives" class="archives">archives </a><a href="/README/" class="archives">README</a></nav></div></header><script>NProgress.set(.4)</script><main id="main" role="main"><article id="post-nginx-qi-yong-http2-2" class="post article white-box article-type-post animated fade-in-top" itemscope itemprop="blogPost"><section class="post-header article-header"><h2 class="title"><a href="/2017/06/17/nginx-qi-yong-http2-2/">Nginx 开启支持 HTTP2</a></h2><div class="subtitle"><time>Jun 17, 2017 </time><span class="tags"><span class="iconfont icon-tag"></span> <a class="tag-link" href="/tags/nginx/">nginx</a> / <a class="tag-link" href="/tags/web-development/">web development</a></span></div></section><section class="content"><div class="article-entry" itemprop="articleBody"><h2 id="HTTP2的好处"><a href="#HTTP2的好处" class="headerlink" title="HTTP2的好处"></a>HTTP2的好处</h2><ul><li>Server Push 主动推送资源 （目前nginx还不支持，新版本nodeJs可以配置实现）</li><li>用帧二进制编码传输数据，连接可以承载任意数量的双向数据流 (所以不用关心，请求的数量了)</li><li>头部压缩，减少请求时间</li></ul><h2 id="版本要求"><a href="#版本要求" class="headerlink" title="版本要求"></a>版本要求</h2><p>Nginx 1.9.5 及其以上版本</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>其实配置很简单，只需要在原本配置的<code>listen</code>处加入 <code>http2</code> 的声明即可，而且对无法支持HTTP2的浏览器，nginx会做自动降级处理。<br>(<a href="https://www.nginx.com/blog/nginx-1-9-5/" target="_blank" rel="external">Nginx 官方说明</a>)</p><pre><code>server {
    listen 443 ssl http2 default_server;

    ssl_certificate    server.crt;
    ssl_certificate_key server.key;
    ...
}
</code></pre><h2 id="查看网站是否启用HTTP2"><a href="#查看网站是否启用HTTP2" class="headerlink" title="查看网站是否启用HTTP2"></a>查看网站是否启用HTTP2</h2><p>在chrome控制台的Network中开启Protocol即可查看请求类型<br><img src="/images/2017/06/http2-1.png" alt=""></p><p>成功开启HTTP2，将会出现h2的标记</p><p><img src="/images/2017/06/http2-2.png" alt=""></p><h2 id="为什么会开启失败"><a href="#为什么会开启失败" class="headerlink" title="为什么会开启失败"></a>为什么会开启失败</h2><p>几个月之前就将树莓派上的Nginx配置支持HTTP2，后来部分服务迁移到某国外服务器，直接将Nginx配置Copy过去却发现没有生效。</p><p>为什么会开启失败，首先第一个Nginx的version一定要对，在version正确的前提下，修改配置文件后，其实我们已经完成开启HTTP2。</p><p>但是如果Nginx所在操作系统OpenSSL Version为1.0.1x, Nginx基于这些版本 的OpenSSL编译，将会支持<br><code>NPN</code>而不支持<code>ALPN</code>，而新版的Chrome 只支持<code>ALPN</code>，所以如果是这种情况在Chrome浏览器中HTTP2依然不会生效。</p><p><a href="https://www.nginx.com/blog/supporting-http2-google-chrome-users/" target="_blank" rel="external">Nginx官方说明</a></p><p>在<a href="https://serverfault.com/questions/775298/debian-jessie-nginx-with-openssl-1-0-2-to-use-alpn-rather-than-npn" target="_blank" rel="external">serverfault.com</a>也有网友给出了解决方案（debian 系统）</p><blockquote><p>This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,<br>consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.<br>Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.</p><p>Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse<br>id sem consectetuer libero luctus adipiscing.</p></blockquote></div></section><section id="gitalk-container"></section></article><script>NProgress.set(.6)</script></main><footer class="footer"><div class="footer-wrap"><div class="footer-link"><h3>LINKS</h3><p><a href="http://1x0.xyz/" target="_blank">Tian1x0</a> <a href="http://shiyang.wang/" target="_blank">Shiyang Wang</a> <a href="http://www.royalmice.com/hankzhou/" target="_blank">Hankzhou</a> <a href="http://sjydh.me/" target="_blank">设计有点货</a> <a href="https://developers.google.com/web/fundamentals/" target="_blank">Web fundamentals</a></p></div><div class="footer-tags"><h3>TAGS</h3><div class="tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac-os-X/">Mac os X</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/os/">os</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/others/">others</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberry-pi/">raspberry pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/soft/">soft</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-development/">web development</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-development推荐方法/">web development推荐方法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/work/">work</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/模块加载器/">模块加载器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编辑器/">编辑器</a></li></ul></div></div><div class="footer-info"><div>Theme <span class="codename"><a href="https://github.com/GGICE/hexo-icer" target="_blank">icer</a></span> designed & coded by <a href="https://ice.gs/" target="_blank">GGICE</a></div><div>Copyright &copy; 2017, <a href="/">ICE.GS</a> . All rights reserved .</div></div></div></footer><script>NProgress.set(.8)</script></div><script src="//cdnjs.xyz/libs/highlight/9.12.0/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad()</script><script src="/js/main.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>document.querySelector("#gitalk-container")&&new Gitalk({clientID:"83a3413b0591f7c338af",clientSecret:"177f437bdc6573b374fa1ef51efb03e4c374d921",repo:"ICE.GS",owner:"GGICE",admin:["GGICE"]}).render("gitalk-container")</script><script>NProgress.done()</script></body>