<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>JavaScript 内存管理和优化 | ICE.GS</title><meta name="description" content="A geeker blog."><meta name="keywords" content="hexo,theme,icer,ggice"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="内存的生命周期创建对象分配所需内存使用该对象当不被使用时释放老的垃圾回收机制老式的浏览器采用引用计数算法垃圾回收，对于循环引用的对象无法回收，已经基本废弃，这里不做讨论。现代浏览器垃圾回收机制现代浏览器采用标记-清除算法垃圾回收。这个算法，根据对象是否可以获得来确定是否回收。算法设置一个根对象，定时从根对象开始，查找所有根开始引用的对象，然后逐级向下查找，确定所有可以获得对象和所有无法获得的对象。"><meta name="keywords" content="web development,web development推荐方法"><meta property="og:type" content="article"><meta property="og:title" content="JavaScript 内存管理和优化"><meta property="og:url" content="https://ice.gs/2016/02/22/javascript-nei-cun-guan-li-he-you-hua/index.html"><meta property="og:site_name" content="ICE.GS"><meta property="og:description" content="内存的生命周期创建对象分配所需内存使用该对象当不被使用时释放老的垃圾回收机制老式的浏览器采用引用计数算法垃圾回收，对于循环引用的对象无法回收，已经基本废弃，这里不做讨论。现代浏览器垃圾回收机制现代浏览器采用标记-清除算法垃圾回收。这个算法，根据对象是否可以获得来确定是否回收。算法设置一个根对象，定时从根对象开始，查找所有根开始引用的对象，然后逐级向下查找，确定所有可以获得对象和所有无法获得的对象。"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2016-02-22T15:33:37.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="JavaScript 内存管理和优化"><meta name="twitter:description" content="内存的生命周期创建对象分配所需内存使用该对象当不被使用时释放老的垃圾回收机制老式的浏览器采用引用计数算法垃圾回收，对于循环引用的对象无法回收，已经基本废弃，这里不做讨论。现代浏览器垃圾回收机制现代浏览器采用标记-清除算法垃圾回收。这个算法，根据对象是否可以获得来确定是否回收。算法设置一个根对象，定时从根对象开始，查找所有根开始引用的对象，然后逐级向下查找，确定所有可以获得对象和所有无法获得的对象。"><link rel="stylesheet" href="//cdn.x21.xyz/libs/nprogress/0.2.0/nprogress.css"><link rel="stylesheet" href="//cdn.x21.xyz/libs/highlight/9.12.0/styles/github-gist.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_405585_yuudmyqpo3q.css"><script src="//cdn.x21.xyz/libs/nprogress/0.2.0/nprogress.js"></script><link rel="stylesheet" href="/style.css"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?403460ed7637fb6c4a9e09a74e662ca0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head></html><body><script>NProgress.start()</script><div id="site-wrapper"><header class="header"><div class="header-wrapper"><a href="/"><img src="/image/logo.jpg" class="logo"></a><div class="social-wrapper"><a href="https://twitter.com/iggice" class="social twitter" target="_blank" rel="external"><span class="iconfont icon-twitter"></span> </a><a href="https://github.com/ggice" class="social github" target="_blank" rel="external"><span class="iconfont icon-github"></span> </a><a href="http://ggice.lofter.com/" class="social lofter" target="_blank" rel="external"><span class="iconfont icon-lofter"></span> </a><a href="https://dribbble.com/ggice" class="social dribbble" target="_blank" rel="external"><span class="iconfont icon-dribbble"></span> </a><a href="mailto:i@ice.gs" class="social email" target="_blank" rel="external"><span class="iconfont icon-email"></span> </a><a href="/atom.xml" class="social rss" target="_blank" rel="external"><span class="iconfont icon-rss"></span> </a><a href="#" class="social search-do" target="_blank" rel="external"><span class="iconfont icon-search"></span></a></div><div class="search-wrap"><div class="search-content animated fade-in"><p class="search-input"><span class="iconfont icon-search"></span> <input tabindex="1"></p><ul class="search-result"><div class="tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac-os-X/">Mac os X</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/os/">os</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/others/">others</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberry-pi/">raspberry pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/soft/">soft</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-development/">web development</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-development推荐方法/">web development推荐方法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/work/">work</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/模块加载器/">模块加载器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编辑器/">编辑器</a></li></ul></div></ul></div></div><nav class="header-nav"><a href="/" class="archives">home </a><a href="/tags/web-development/" class="archives">web development </a><a href="/tags/soft/" class="archives">soft </a><a href="/tags/os/" class="archives">os </a><a href="/archives" class="archives">archives </a><a href="/README/" class="archives">README</a></nav></div></header><script>NProgress.set(.4)</script><main id="main" role="main"><article id="post-javascript-nei-cun-guan-li-he-you-hua" class="post article white-box article-type-post animated fade-in-top" itemscope itemprop="blogPost"><section class="post-header article-header"><h2 class="title"><a href="/2016/02/22/javascript-nei-cun-guan-li-he-you-hua/">JavaScript 内存管理和优化</a></h2><div class="subtitle"><time>Feb 22, 2016 </time><span class="tags"><span class="iconfont icon-tag"></span> <a class="tag-link" href="/tags/web-development/">web development</a> / <a class="tag-link" href="/tags/web-development推荐方法/">web development推荐方法</a></span></div></section><section class="content"><div class="article-entry" itemprop="articleBody"><h3 id="内存的生命周期"><a href="#内存的生命周期" class="headerlink" title="内存的生命周期"></a>内存的生命周期</h3><ol><li>创建对象分配所需内存</li><li>使用该对象</li><li>当不被使用时释放</li></ol><h3 id="老的垃圾回收机制"><a href="#老的垃圾回收机制" class="headerlink" title="老的垃圾回收机制"></a>老的垃圾回收机制</h3><p>老式的浏览器采用<code>引用计数算法垃圾回收</code>，对于循环引用的对象无法回收，已经基本废弃，这里不做讨论。</p><h3 id="现代浏览器垃圾回收机制"><a href="#现代浏览器垃圾回收机制" class="headerlink" title="现代浏览器垃圾回收机制"></a>现代浏览器垃圾回收机制</h3><p>现代浏览器采用<code>标记-清除算法垃圾回收</code>。这个算法，根据对象是否可以获得来确定是否回收。</p><p>算法设置一个根对象，定时从根对象开始，查找所有根开始引用的对象，然后逐级向下查找，确定所有可以获得对象和所有无法获得的对象。</p><p>这个算法解决了循环引用无法回收的问题，问题是无法被查询到的对象都会删除，可能存在小概率的误删。</p><h3 id="主动内存回收"><a href="#主动内存回收" class="headerlink" title="主动内存回收"></a>主动内存回收</h3><pre><code>var a = { some code }
a = null //a对象内存将会被回收
</code></pre><p>对于一些mvc框架，会主动控制视图或者控制器的生命周期，完成业务逻辑和提高运行效率。</p><h3 id="内存诊断工具"><a href="#内存诊断工具" class="headerlink" title="内存诊断工具"></a>内存诊断工具</h3><p>Chrome 的 Profiler</p><h3 id="V8-引擎的垃圾回收"><a href="#V8-引擎的垃圾回收" class="headerlink" title="V8 引擎的垃圾回收"></a>V8 引擎的垃圾回收</h3><p><a href="http://alinode.aliyun.com/blog/14" target="_blank" rel="noopener">这里</a>有篇文章介绍v8引擎的垃圾回收机制</p><h3 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h3><h4 id="善用函数"><a href="#善用函数" class="headerlink" title="善用函数"></a>善用函数</h4><p>使用匿名包裹页面，可以利于内存的回收。</p><pre><code>;(function() {
  // 主业务代码
})();
</code></pre><h4 id="避免全局变量"><a href="#避免全局变量" class="headerlink" title="避免全局变量"></a>避免全局变量</h4><p>默认情况下，全局变量是不会被回收的。</p><h4 id="主动解除引用"><a href="#主动解除引用" class="headerlink" title="主动解除引用"></a>主动解除引用</h4><p>对于，明确的业务流程可以在恰当的时间，主动解除变量引用来，使得被回收。</p><h4 id="良好的闭包管理"><a href="#良好的闭包管理" class="headerlink" title="良好的闭包管理"></a>良好的闭包管理</h4><p>这里的largeStr 并不会被回收</p><pre><code>var a = function () {
    var largeStr = new Array(1000000).join(&#39;x&#39;);
    return function () {
        return largeStr;
    };
}();
</code></pre><p>这里的largeStr 是会被回收的</p><pre><code>var a = function () {
    var smallStr = &#39;x&#39;;
    var largeStr = new Array(1000000).join(&#39;x&#39;);
    return function (n) {
        return smallStr;
    };
}();
</code></pre><p>所以在闭包的使用时，应该合理的设置返回值，并且关注返回值的回收。</p></div></section><section id="gitalk-container"></section></article><script>NProgress.set(.6)</script></main><footer class="footer"><div class="footer-wrap"><div class="footer-link"><h3>LINKS</h3><p><a href="http://1x0.xyz/" target="_blank">Tian1x0</a> <a href="http://www.royalmice.com/hankzhou/" target="_blank">Hankzhou</a> <a href="http://sjydh.me/" target="_blank">设计有点货</a> <a href="https://developers.google.com/web/fundamentals/" target="_blank">Web fundamentals</a></p></div><div class="footer-tags"><h3>TAGS</h3><div class="tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac-os-X/">Mac os X</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/os/">os</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/others/">others</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberry-pi/">raspberry pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/soft/">soft</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-development/">web development</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-development推荐方法/">web development推荐方法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/work/">work</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/模块加载器/">模块加载器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编辑器/">编辑器</a></li></ul></div></div><div class="footer-info"><div>Theme <span class="codename"><a href="https://github.com/GGICE/hexo-icer" target="_blank">icer</a></span> designed & coded by <a href="https://ice.gs/" target="_blank">GGICE</a></div><div>Copyright &copy; 2019, <a href="/">ICE.GS</a> . All rights reserved .</div></div></div></footer><script>NProgress.set(.8)</script></div><script src="//cdn.x21.xyz/libs/highlight/9.12.0/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad()</script><script src="/js/main.js"></script><script src="/js/md5.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>document.querySelector("#gitalk-container")&&new Gitalk({clientID:"83a3413b0591f7c338af",clientSecret:"177f437bdc6573b374fa1ef51efb03e4c374d921",repo:"ICE.GS",owner:"GGICE",admin:["GGICE"],id:MD5(location.pathname),distractionFreeMode:!1}).render("gitalk-container")</script><script>NProgress.done()</script></body>